<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Viewer</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 30px; }
    .muted { color:#666; }
    code { background:#f6f6f6; padding:2px 6px; border-radius:6px; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <div class="muted">VERSION: <code>2026-01-25-LOOP-FIX2</code></div>
  <div id="status" class="muted">בודק הרשאה…</div>

<script>
(async () => {
  // ====== חובה לעדכן לערכים האמיתיים שלך ====== const SUPABASE_URL = 'https://qcwimczsiuxkarwfiyai.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFjd2ltY3pzaXV4a2Fyd2ZpeWFpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM1OTEwMzgsImV4cCI6MjA2OTE2NzAzOH0.zpMcORTD1voqZFj5QaPUc-EXf1juqnlTTP00jV6_TvI';

  const LAUNCHER_URL = "launcher.html";

  const statusEl = document.getElementById("status");
  const setStatus = (t) => statusEl.textContent = t;

  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
    auth: { persistSession: true, autoRefreshToken: true, detectSessionInUrl: true }
  });

  const { data, error } = await supabase.auth.getSession();
  if (error) console.warn(error);

  const session = data && data.session;
  if (!session) {
    // אין session => חוזרים לכניסה (ומשם ל-login_phone)
    setStatus("אין Session. חוזר לכניסה…");
    window.location.replace(LAUNCHER_URL);
    return;
  }

  setStatus("הרשאה תקפה. טוען…");

  // כאן ממשיך ה-Viewer שלך (השאר את הקוד/טעינת ה-UI הקיימים אחרי ה-Guard הזה)
})();
</script>

</body>
</html>
