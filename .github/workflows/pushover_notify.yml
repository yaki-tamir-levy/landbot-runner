name: Pushover Notify (Israel Time)

on:
  schedule:
    # Israel winter time (UTC+2):
    # 10,14,18,22 Israel  ==>  8,12,16,20 UTC
    - cron: "0 8,12,16,20 * * *"

  workflow_dispatch:

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install deps
        run: pip install requests

      - name: Run risk_reviews notifier (one alert)
        env:
          SUPABASE_URL:              ${{ secrets.SUPABASE_URL }}
          SUPABASE_SERVICE_ROLE_KEY: ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}
          PUSHOVER_TOKEN:            ${{ secrets.PUSHOVER_TOKEN }}
          PUSHOVER_USER:             ${{ secrets.PUSHOVER_USER }}
          PUSHOVER_USER_2:           ${{ secrets.PUSHOVER_USER_2 }}    # אופציונלי
          PUSHOVER_URL:              ${{ secrets.PUSHOVER_URL }}       # אופציונלי (לינק ל-launcher)
          PUSHOVER_URL_TITLE:        ${{ secrets.PUSHOVER_URL_TITLE }} # אופציונלי
        run: |
          python tools/risk_reviews_notify.py
